<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Escape the Maze</title>
    <meta name="description" content="Escape the Maze">
    <script src="https://aframe.io/releases/0.9.2/aframe.min.js"></script>
    <script src="./geometries/example.js"></script>
    <script src="https://mixedreality.mozilla.org/ammo.js/builds/ammo.wasm.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/n5ro/aframe-physics-system@v4.0.1/dist/aframe-physics-system.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
    <script src="https://recast-api.donmccurdy.com/aframe-inspector-plugin-recast.js"></script>

   <!--Networked-A-Frame-->
   <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.3.0/socket.io.slim.js"></script>
   <script src="/easyrtc/easyrtc.js"></script>
   <script src="https://unpkg.com/networked-aframe@^0.8.0/dist/networked-aframe.min.js"></script>
  </head>
  <body>
    <a-scene networked-scene="app: myApp; room: room1; debug: true;" physics="gravity: -9.8" inspector-plugin-recast> <!--TODO: remove inspector in final build-->
      <a-assets>
        <template id="avatar-template">
          <a-entity class="avatar">
            <a-sphere class="head"
              color="#5985ff"
              scale="0.9 1 0.8"
            ></a-sphere>
            <a-entity class="face"
              position="0 0.1 0"
            >
              <a-sphere class="eye"
                color="#efefef"
                position="0.32 0.2 -0.7"
                scale="0.24 0.24 0.24"
              >
                <a-sphere class="pupil"
                  color="#000"
                  position="0 0 -1"
                  scale="0.2 0.2 0.2"
                ></a-sphere>
              </a-sphere>
              <a-sphere class="eye"
                color="#efefef"
                position="-0.32 0.2 -0.7"
                scale="0.24 0.24 0.24"
              >
                <a-sphere class="pupil"
                  color="#000"
                  position="0 0 -1"
                  scale="0.2 0.2 0.2"
                ></a-sphere>
              </a-sphere>
            </a-entity>
          </a-entity>
        </template>
        <template id="landmark-template">
          <a-entity light="type: point; intensity: 5; distance: 10; decay: 2"> 
            <a-sphere class="landmark" material="emissive: #cbfaff; emissiveIntensity: 10; opacity: 1"
              color="#ffffff"
              scale="0.6 0.6 0.6"
            ></a-sphere>
          </a-entity>
        </template>
        <img id="groundTexture" src="https://cdn.aframe.io/a-painter/images/floor.jpg" crossorigin="anonymous">
        <img id="skyTexture" src="https://cdn.aframe.io/a-painter/images/sky.jpg" crossorigin="anonymous">
        <a-asset-item id="maze-nav-mesh" src="/assets/navmesh/maze_navmesh.gltf"></a-asset-item>
        <a-asset-item id="maze-obj" src="./geometries/maze20x20.obj" crossorigin="anonymous"></a-asset-item>
      </a-assets>
      <!-- Camera VR -->
      <a-entity movement-controls="speed: 0.35; constrainToNavMesh: true" networked="template:#avatar-template;attachTemplateToLocal:false;"  position="2 -1.6 60">
        <a-entity id="player" rotation="0 180 0" camera="active: true" networked="template:#avatar-template;attachTemplateToLocal:false;" position="0 1.6 0" look-controls></a-entity>
        </a-entity>
      </a-entity>
          
      <!-- Sky -->
      <a-sky height="2048" position="0 -1.6 0" radius="80" src="#skyTexture" theta-length="90" width="2048"></a-sky>

      <!-- Maze -->
      <a-entity obj-model="obj: #maze-obj" material="color: #18314d; roughness: 1; metalness: 0" position="-5.5 -21 -7.4" scale="1.95 2.2 1.95"></a-entity>

      <!-- Light -->
      <a-light type="ambient" color="#999999"></a-light>
      <a-light type="point" intensity="0.6" position="42 44 84"></a-light>

      <!-- Ground -->
      <a-plane static-body position="0 -1.6 0" src="#groundTexture" material="roughness: 1; metalness: 0" scale="200 200 1" repeat="1000 1000 1" rotation="-90 0 0"></a-plane>

      <!-- Collider system (Navigation mesh) of #maze-obj -->
      <a-entity gltf-model="#maze-nav-mesh" nav-mesh position="0 -1.7 0" visible="false"></a-entity> <!--edited nav mesh scale="2.88 0 2.88"-->

      <!--Tracked controls. -->
      <a-entity hand-controls="hand: left"></a-entity>
      <a-entity hand-controls="hand: right"></a-entity>
    </a-scene>
  </body>
</html>
