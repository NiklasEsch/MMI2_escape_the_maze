<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Escape the Maze</title>
    <meta name="description" content="Escape the Maze">
    <script src="https://aframe.io/releases/0.9.2/aframe.min.js"></script>
    <script src="./geometries/example.js"></script>
    <script src="https://mixedreality.mozilla.org/ammo.js/builds/ammo.wasm.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/n5ro/aframe-physics-system@v4.0.1/dist/aframe-physics-system.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
    <script src="https://recast-api.donmccurdy.com/aframe-inspector-plugin-recast.js"></script>
   <!--Networked-A-Frame-->
   <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.3.0/socket.io.slim.js"></script>
   <script src="/easyrtc/easyrtc.js"></script>
   <script src="https://unpkg.com/networked-aframe@^0.8.0/dist/networked-aframe.min.js"></script>
  </head>
  <body>
    <a-scene networked-scene="app: myApp; room: room1; debug: true;" physics="gravity: -9.8" inspector-plugin-recast> <!--TODO: remove inspector in final build-->
      <a-assets>
        <template id="avatar-template">
          <a-entity class="avatar">
            <a-sphere class="head"
              color="#5985ff"
              scale="0.45 0.5 0.4"
            ></a-sphere>
            <a-entity class="face"
              position="0 0.05 0"
            >
              <a-sphere class="eye"
                color="#efefef"
                position="0.16 0.1 -0.35"
                scale="0.12 0.12 0.12"
              >
                <a-sphere class="pupil"
                  color="#000"
                  position="0 0 -1"
                  scale="0.2 0.2 0.2"
                ></a-sphere>
              </a-sphere>
              <a-sphere class="eye"
                color="#efefef"
                position="-0.16 0.1 -0.35"
                scale="0.12 0.12 0.12"
              >
                <a-sphere class="pupil"
                  color="#000"
                  position="0 0 -1"
                  scale="0.2 0.2 0.2"
                ></a-sphere>
              </a-sphere>
            </a-entity>
          </a-entity>
        </template>
        <img id="groundTexture" src="https://cdn.aframe.io/a-painter/images/floor.jpg" crossorigin="anonymous">
        <img id="skyTexture" src="https://cdn.aframe.io/a-painter/images/sky.jpg" crossorigin="anonymous">
        <a-asset-item id="maze-nav-mesh" src="/assets/navmesh/maze_navmesh.gltf"></a-asset-item>
        <a-asset-item id="maze-obj" src="./geometries/maze.obj" crossorigin="anonymous"></a-asset-item>
      </a-assets>

      <!-- Camera -->
      <a-entity movement-controls="speed: 0.15; constrainToNavMesh: true" position="0 0 2">
        <a-entity id="player" networked="template:#avatar-template;attachTemplateToLocal:false;" camera position="0 1.6 0" wasd-controls look-controls></a-entity>
          <a-cursor></a-cursor>
        </a-entity>
      </a-entity>

      <!-- Sky -->
      <a-sky height="2048" radius="80" src="#skyTexture" theta-length="90" width="2048"></a-sky>

      <!-- Maze -->
      <a-entity obj-model="obj: #maze-obj" position="-1.2 0 35" ></a-entity>

      <!-- Light -->
      <a-light type="ambient" color="#999999"></a-light>
      <a-light type="point" intensity="0.6" position="2 4 4"></a-light>

      <!-- Ground -->
      <a-plane static-body src="#groundTexture" scale="200 200 1" repeat="1000 1000 1" rotation="-90 0 0"></a-plane>

      <!-- Collider system (Navigation mesh) of #maze-obj -->
      <a-entity gltf-model="#maze-nav-mesh" nav-mesh position="0 -0.1 0" visible="false"></a-entity>

      <!--Tracked controls. -->
      <a-entity hand-controls="hand: left"></a-entity>
      <a-entity hand-controls="hand: right"></a-entity>
    </a-scene>
  </body>
</html>
