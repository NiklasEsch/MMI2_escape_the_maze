<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Escape the Maze</title>
    <meta name="description" content="Escape the Maze">
    <script src="https://aframe.io/releases/0.9.2/aframe.min.js"></script>
    <script src="./geometries/example.js"></script>
    <script src="https://mixedreality.mozilla.org/ammo.js/builds/ammo.wasm.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/n5ro/aframe-physics-system@v4.0.1/dist/aframe-physics-system.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
    <script src="httpsy://recast-api.donmccurdy.com/aframe-inspector-plugin-recast.js"></script>
    <script src="./multitouch-look-controls.js"></script>
    <!--Networked-A-Frame-->
   <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.3.0/socket.io.slim.js"></script>
   <script src="/easyrtc/easyrtc.js"></script>
   <script src="https://unpkg.com/networked-aframe@^0.8.0/dist/networked-aframe.min.js"></script>
    <script src="https://rawgit.com/rdub80/aframe-gui/master/dist/aframe-gui.min.js"></script>
    <script >
      window.hitMonster = function () {
        console.log("Monster defeated");
      }

      window.collectCoin = function () {
        document.getElementById("collectedCoinsValue")
        var coinValue = document.getElementById("collectedCoinsValue").getAttribute('value');
        newCoinValue = +coinValue + 1;
        document.getElementById("collectedCoinsValue").setAttribute('value', newCoinValue);
      }

      function startTimer(duration, display) {
		    var timer = duration, minutes, seconds;
		    setInterval(function () {
		        seconds = parseInt(timer % 60, 10);
		        seconds = seconds < 10 ? "0" + seconds : seconds;
		        display.setAttribute('count-down', seconds);
		        if (--timer < 0) {
		            timer = duration;
		        }
		    }, 1000);
      }

      window.onload = function () {
          var countDownEntity = document.getElementById("timer"),
            duration = countDownEntity.getAttribute('count-down');
            startTimer(duration, countDownEntity);
      };
    </script>

  </head>
  <body>
    <a-scene networked-scene="app: myApp; room: room1; debug: true;" physics="gravity: -9.8"> <!--TODO: remove inspector in final build-->
      <a-assets>
        <template id="avatar-template">
          <a-entity class="avatar">
            <a-sphere class="head"
              color="#5985ff"
              scale="0.9 1 0.8"
            ></a-sphere>
            <a-entity class="face"
              position="0 0.1 0"
            >
              <a-sphere class="eye"
                color="#efefef"
                position="0.32 0.2 -0.7"
                scale="0.24 0.24 0.24"
              >
                <a-sphere class="pupil"
                  color="#000"
                  position="0 0 -1"
                  scale="0.2 0.2 0.2"
                ></a-sphere>
              </a-sphere>
              <a-sphere class="eye"
                color="#efefef"
                position="-0.32 0.2 -0.7"
                scale="0.24 0.24 0.24"
              >
                <a-sphere class="pupil"
                  color="#000"
                  position="0 0 -1"
                  scale="0.2 0.2 0.2"
                ></a-sphere>
              </a-sphere>
            </a-entity>
          </a-entity>
        </template>
        <img id="groundTexture" src="https://cdn.aframe.io/a-painter/images/floor.jpg" crossorigin="anonymous">
        <img id="skyTexture" src="https://cdn.aframe.io/a-painter/images/sky.jpg" crossorigin="anonymous">
        <a-asset-item id="maze-nav-mesh" src="/assets/navmesh/maze_navmesh.gltf"></a-asset-item>
        <a-asset-item id="maze-obj" src="./geometries/maze20x20.obj" crossorigin="anonymous"></a-asset-item>
      </a-assets>

      <!-- Camera SMARTPHONE -->
      <a-entity position="0 75 0" rotation="-90 0 0">
        <a-camera look-controls-enabled="false"> <!--multitouch-look-controls for touch controls, could not get it running-->
        </a-camera>
      </a-entity>

      <!-- Sky -->
      <a-sky height="2048" radius="80" src="#skyTexture" theta-length="90" width="2048"></a-sky>

      <!-- Maze -->
      <a-entity obj-model="obj: #maze-obj" position="-5.5 -26 -7.4" scale="1.95 1.95 1.95"></a-entity>

      <!-- Light -->
      <a-light type="ambient" color="#999999"></a-light>
      <a-light type="point" intensity="0.6" position="42 44 84"></a-light>

      <!-- Ground -->
      <a-plane static-body src="#groundTexture" scale="200 200 1" repeat="1000 1000 1" rotation="-90 0 0"></a-plane>

      <!-- Mouse cursor so we can click on the scene with mouse or touch. -->
		  <a-entity id="mouseCursor" cursor="rayOrigin: mouse" raycaster="objects: [gui-interactable]"></a-entity>
		
      <!-- Hand controls -->
      <a-entity id="leftHand" laser-controls="hand: left" raycaster="objects: [gui-interactable]"></a-entity>
		  <a-entity id="rightHand" laser-controls="hand: right" raycaster="objects: [gui-interactable]"></a-entity>

      <!-- GUI -->
      <a-gui-flex-container 
        id="hitMonsterButtonContainer"
        flex-direction="column" 
        justify-content="center" 
        width="2.5" 
        height="0.7" 
        position="-6 70 3.5" 
        rotation="-90 0 0"
      >
        <a-gui-button
          id="hitMonsterButton"
          width="2.5" 
          height="0.7" 
          onclick="hitMonster" key-code="32"
          value="Hit Monster"
          font-size="0.25"
          font-color="#F0F0F0"
          active-color="#414BB2"
          hover-color="#7bb8e8"
          border-color="black"
          focus-color="black"
          background-color="#2D9BF0"
        >
        </a-gui-button>
      </a-gui-flex-container>

      <a-gui-flex-container 
        id="collectCoinButtonContainer"
        flex-direction="column" 
        justify-content="center" 
        width="2.5" 
        height="0.7" 
        position="6 70 3.5" 
        rotation="-90 0 0"
      >
        <a-gui-button
          id="collectCoinButton"
          width="2.5" 
          height="0.7" 
          onclick="collectCoin" key-code="31"
          value="Collect Coin"
          font-size="0.25"
          font-color="#F0F0F0"
          active-color="#414BB2"
          hover-color="#7bb8e8"
          border-color="black"
          focus-color="black"
          background-color="#2D9BF0"
        >
        </a-gui-button>
      </a-gui-flex-container>


      <a-gui-flex-container 
        id="remainingTimeLabelContainer"
        flex-direction="column" 
        justify-content="center" 
        align-items="center"
        width="2.5" 
        height="0.75" 
        position="-6 70 -3.3" 
        rotation="-90 0 0"
      >
        <a-gui-label
          id="remainingTimeLabel"
          width="2.5" 
          height="0.75"
          value="Remaining time"
          font-size="0.35"
          line-height="0.8"
          font-color="#F0F0F0"
          background-color="black"
        >
        </a-gui-label>
        <a-gui-circle-timer
				id="timer"
				height="0.75"
				count-down="60"
				callback="timedout"
				background-color="#999"

			>
			</a-gui-circle-timer>
        <!--<a-gui-label
          id="remainingTimeValue"
          width="2.5" 
          height="0.5"
          value="00:35"
          font-size="0.35"
          line-height="0.8"
          font-color="#F0F0F0"
          background-color="black"
        >
        </a-gui-label>-->
      </a-gui-flex-container>

      <a-gui-flex-container 
        id="remainingLandmarksLabelContainer"
        flex-direction="column" 
        justify-content="center" 
        align-items="center"
        width="2.5" 
        height="0.75" 
        position="-6 70 -1.3" 
        rotation="-90 0 0"
      >
        <a-gui-label
          id="remainingLandmarksLabel"
          width="2.5" 
          height="0.75"
          value="Remaining landmarks"
          font-size="0.35"
          line-height="0.8"
          font-color="#F0F0F0"
          background-color="black"
        >
        </a-gui-label>
        <a-gui-label
          id="remainingLandmarksValue"
          width="2.5" 
          height="0.5"
          value="10"
          font-size="0.35"
          line-height="0.8"
          font-color="#F0F0F0"
          background-color="black"
        >
        </a-gui-label>
      </a-gui-flex-container>

      <a-gui-flex-container 
        id="collectedCoinsLabelContainer"
        flex-direction="column" 
        justify-content="center" 
        width="2.5" 
        height="0.75" 
        position="6 70 -3.3" 
        rotation="-90 0 0"
      >
        <a-gui-label
          id="collectedCoinsLabel"
          width="2.5" 
          height="0.75"
          value="Collected Coins"
          font-size="0.35"
          line-height="0.8"
          font-color="#F0F0F0"
          background-color="black"
        >
        </a-gui-label>
        <a-gui-label
          id="collectedCoinsValue"
          width="2.5" 
          height="0.5"
          value="0"
          font-size="0.35"
          line-height="0.8"
          font-color="#F0F0F0"
          background-color="black"
        >
        </a-gui-label>
      </a-gui-flex-container>

      
    </a-scene>
  </body>
</html>
